<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>موقع الشطرنج</title>
</head>
<body>
    <h1>مرحبًا بك في موقع الشطرنج!</h1>
    <p>تم تحميل هذا المحتوى من ملف HTML داخل تطبيق Flask الخاص بك.</p>

    <h2>معلومات المستخدم:</h2>
    <p><strong>معرف المستخدم:</strong> <span id="user-id">{{ user_id }}</span></p>
    <p><strong>اسم المستخدم:</strong> <span id="username">{{ username }}</span></p>
    <p><strong>عدد النقاط:</strong> <span id="points">{{ points }}</span></p>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();

        const user = tg.initDataUnsafe?.user;

        if (user) {
            const userId = user.id;
            const username = user.username || user.first_name || 'Unknown';

            fetch('http://127.0.0.1:5000/save-user', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: userId, username: username })
            })
            .then(response => response.json())
            .then(data => {
                if (data.user_id) {
                    document.getElementById('user-id').innerText = data.user_id;
                    document.getElementById('username').innerText = data.username;
                    document.getElementById('points').innerText = data.points;
                }
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</body>
</html>
